# SUVIDHA Platform - Architecture Diagram

## ðŸ—ï¸ Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT APPLICATIONS                          â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Web App    â”‚  â”‚  Mobile App  â”‚  â”‚  Kiosk App   â”‚             â”‚
â”‚  â”‚ (React/Vite) â”‚  â”‚   (React)    â”‚  â”‚   (React)    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP/REST
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MAIN SERVER (Port 5000)                          â”‚
â”‚                         API Gateway                                  â”‚
â”‚                                                                      â”‚
â”‚  Features:                                                          â”‚
â”‚  â€¢ Health Check Endpoints                                           â”‚
â”‚  â€¢ Service Discovery                                                â”‚
â”‚  â€¢ Load Balancing (Future)                                          â”‚
â”‚  â€¢ Rate Limiting (Future)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                  â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTH SERVICE   â”‚ â”‚ ELECTRICITY     â”‚ â”‚  PAYMENT        â”‚ â”‚  DOCUMENT       â”‚
â”‚   Port 3001     â”‚ â”‚   SERVICE       â”‚ â”‚   SERVICE       â”‚ â”‚   SERVICE       â”‚
â”‚                 â”‚ â”‚   Port 3002     â”‚ â”‚   Port 3003     â”‚ â”‚   Port 3004     â”‚
â”‚ âœ… IMPLEMENTED  â”‚ â”‚ âœ… IMPLEMENTED  â”‚ â”‚ âœ… IMPLEMENTED  â”‚ â”‚ ðŸš§ PENDING      â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ â€¢ OTP Auth      â”‚ â”‚ â€¢ Bill Mgmt     â”‚ â”‚ â€¢ Multi-Gateway â”‚ â”‚ â€¢ Receipt Gen   â”‚
â”‚ â€¢ User Mgmt     â”‚ â”‚ â€¢ Connections   â”‚ â”‚ â€¢ Transactions  â”‚ â”‚ â€¢ PDF Creation  â”‚
â”‚ â€¢ JWT Tokens    â”‚ â”‚ â€¢ Meter Reading â”‚ â”‚ â€¢ Refunds       â”‚ â”‚ â€¢ File Upload   â”‚
â”‚ â€¢ RBAC          â”‚ â”‚ â€¢ Bill Status   â”‚ â”‚ â€¢ Bill Updates  â”‚ â”‚                 â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PostgreSQL  â”‚ â”‚ â”‚ â”‚   MongoDB   â”‚ â”‚ â”‚ â”‚   MongoDB   â”‚ â”‚ â”‚ â”‚   MongoDB   â”‚ â”‚
â”‚ â”‚ Password:   â”‚ â”‚ â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚
â”‚ â”‚ 1234567890  â”‚ â”‚ â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚
â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚
â”‚ â”‚ Tables:     â”‚ â”‚ â”‚ â”‚Collections: â”‚ â”‚ â”‚ â”‚Collections: â”‚ â”‚ â”‚ â”‚Collections: â”‚ â”‚
â”‚ â”‚ â€¢ users     â”‚ â”‚ â”‚ â”‚â€¢ bills      â”‚ â”‚ â”‚ â”‚â€¢ payments   â”‚ â”‚ â”‚ â”‚â€¢ documents  â”‚ â”‚
â”‚ â”‚ â€¢ otp_verif â”‚ â”‚ â”‚ â”‚â€¢ connectionsâ”‚ â”‚ â”‚ â”‚             â”‚ â”‚ â”‚ â”‚             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â–¼                  â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN SERVICE  â”‚ â”‚   GAS SERVICE   â”‚ â”‚  WATER SERVICE  â”‚ â”‚  NOTIFICATION   â”‚
â”‚   Port 3005     â”‚ â”‚   Port 3006     â”‚ â”‚   Port 3007     â”‚ â”‚   SERVICE       â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚   Port 3008     â”‚
â”‚ ðŸš§ PENDING      â”‚ â”‚ ðŸš§ PENDING      â”‚ â”‚ ðŸš§ PENDING      â”‚ â”‚ ðŸš§ PENDING      â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ â€¢ Dashboard     â”‚ â”‚ â€¢ Gas Bills     â”‚ â”‚ â€¢ Water Bills   â”‚ â”‚ â€¢ SMS (OTP)     â”‚
â”‚ â€¢ User Mgmt     â”‚ â”‚ â€¢ Connections   â”‚ â”‚ â€¢ Connections   â”‚ â”‚ â€¢ Email         â”‚
â”‚ â€¢ Analytics     â”‚ â”‚ â€¢ Usage Track   â”‚ â”‚ â€¢ Usage Track   â”‚ â”‚ â€¢ Push Notif    â”‚
â”‚ â€¢ Monitoring    â”‚ â”‚ â€¢ Bill Status   â”‚ â”‚ â€¢ Bill Status   â”‚ â”‚ â€¢ Templates     â”‚
â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚ â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   MongoDB   â”‚ â”‚ â”‚ â”‚   MongoDB   â”‚ â”‚ â”‚ â”‚   MongoDB   â”‚ â”‚ â”‚ â”‚   MongoDB   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ” Authentication Flow (OTP-Based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚                                    â”‚Auth Service â”‚
â”‚         â”‚                                    â”‚  (3001)     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                â”‚
     â”‚  1. Request OTP                                â”‚
     â”‚  POST /auth/request-otp                        â”‚
     â”‚  { phoneNumber: "9876543210",                 â”‚
     â”‚    purpose: "registration" }                   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                â”‚
     â”‚                  2. Generate 6-digit OTP       â”‚
     â”‚                     (e.g., 742856)             â”‚
     â”‚                                                â”‚
     â”‚                  3. Save to DB                 â”‚
     â”‚                     (expires: 10 min)          â”‚
     â”‚                                                â”‚
     â”‚                  4. Send OTP                   â”‚
     â”‚                     (Console in dev mode)      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  { message: "OTP sent successfully",          â”‚
     â”‚    expiresIn: 10 }                             â”‚
     â”‚                                                â”‚
     â”‚  5. Register with OTP                          â”‚
     â”‚  POST /auth/register                           â”‚
     â”‚  { phoneNumber: "9876543210",                 â”‚
     â”‚    otp: "742856",                              â”‚
     â”‚    username: "john_doe",                       â”‚
     â”‚    email: "john@example.com" }                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                â”‚
     â”‚                  6. Verify OTP                 â”‚
     â”‚                     â€¢ Check expiry             â”‚
     â”‚                     â€¢ Check attempts (max 3)   â”‚
     â”‚                     â€¢ Mark as verified         â”‚
     â”‚                                                â”‚
     â”‚                  7. Create user account        â”‚
     â”‚                     in PostgreSQL              â”‚
     â”‚                                                â”‚
     â”‚                  8. Generate JWT tokens        â”‚
     â”‚                     â€¢ Access token (15 min)    â”‚
     â”‚                     â€¢ Refresh token (7 days)   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  { user: {...},                                â”‚
     â”‚    accessToken: "eyJ...",                      â”‚
     â”‚    refreshToken: "eyJ..." }                    â”‚
     â”‚                                                â”‚
```

---

## ðŸ’³ Payment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚         â”‚Bill      â”‚         â”‚Payment      â”‚         â”‚Bill        â”‚
â”‚         â”‚         â”‚Service   â”‚         â”‚Service      â”‚         â”‚Service     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚ 1. View Bill      â”‚                       â”‚                      â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                      â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚ 2. Bill Details   â”‚                       â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                      â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚ 3. Initiate Payment                       â”‚                      â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚                   â”‚       4. Create transaction                  â”‚
     â”‚                   â”‚          in DB (pending)                     â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚ 5. Payment Gateway URL                    â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚ 6. Complete Payment                       â”‚                      â”‚
     â”‚    (Razorpay/PayTM)                       â”‚                      â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚                   â”‚       7. Update payment status               â”‚
     â”‚                   â”‚          (success/failed)                    â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚                   â”‚       8. Update bill status                  â”‚
     â”‚                   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                   â”‚                       â”‚                      â”‚
     â”‚                   â”‚                       â”‚  9. Mark as paid     â”‚
     â”‚                   â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 10. Payment Confirmation                  â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
     â”‚                   â”‚                       â”‚                      â”‚
```

---

## ðŸ“Š Database Schema Overview

### PostgreSQL (Auth Service)

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 USERS TABLE                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (SERIAL PRIMARY KEY)                   â”‚
â”‚ â€¢ username (VARCHAR UNIQUE)                 â”‚
â”‚ â€¢ email (VARCHAR UNIQUE)                    â”‚
â”‚ â€¢ phone_number (VARCHAR UNIQUE) â­          â”‚
â”‚ â€¢ role (VARCHAR: user/admin/operator)       â”‚
â”‚ â€¢ refresh_token (TEXT)                      â”‚
â”‚ â€¢ is_verified (BOOLEAN)                     â”‚
â”‚ â€¢ last_login (TIMESTAMP)                    â”‚
â”‚ â€¢ created_at, updated_at                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          OTP_VERIFICATIONS TABLE            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (SERIAL PRIMARY KEY)                   â”‚
â”‚ â€¢ phone_number (VARCHAR) â­                  â”‚
â”‚ â€¢ otp_code (VARCHAR(6)) â­                   â”‚
â”‚ â€¢ purpose (login/registration/reset)        â”‚
â”‚ â€¢ expires_at (TIMESTAMP) â­                  â”‚
â”‚ â€¢ attempts (INTEGER, max 3) â­              â”‚
â”‚ â€¢ is_verified (BOOLEAN)                     â”‚
â”‚ â€¢ created_at                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MongoDB Collections

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Electricity     â”‚  â”‚    Payments     â”‚  â”‚   Gas/Water     â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚ â€¢ bills         â”‚  â”‚ â€¢ payments      â”‚  â”‚ â€¢ bills         â”‚
â”‚ â€¢ connections   â”‚  â”‚ â€¢ transactions  â”‚  â”‚ â€¢ connections   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Service Communication Patterns

### 1. Authentication Check (All Services â†’ Auth)

```
Service Request â†’ Verify JWT Token â†’ Auth Service
                                    â†“
                              Valid/Invalid
                                    â†“
                            Proceed/Reject
```

### 2. Payment Update (Payment â†’ Bill Services)

```
Payment Success â†’ Update Bill Status â†’ Electricity/Gas/Water Service
                                    â†“
                              Mark as Paid
```

### 3. Notification Trigger (All Services â†’ Notification)

```
Event Occurs â†’ Send Notification â†’ Notification Service
                                    â†“
                           SMS/Email/Push
```

---

## ðŸ“± API Endpoint Summary

### Auth Service (3001)

```
POST   /api/v1/auth/request-otp      # Request OTP
POST   /api/v1/auth/register          # Register with OTP
POST   /api/v1/auth/login             # Login with OTP
POST   /api/v1/auth/logout            # Logout
POST   /api/v1/auth/refresh-token     # Refresh access token
POST   /api/v1/auth/verify-token      # Verify token validity
```

### Electricity Service (3002)

```
GET    /api/v1/electricity/bills                          # Get all bills
GET    /api/v1/electricity/bills/:billNumber              # Get bill details
POST   /api/v1/electricity/bills/generate                 # Generate new bill
PATCH  /api/v1/electricity/bills/:billId/status           # Update bill status
GET    /api/v1/electricity/connections                    # Get connections
POST   /api/v1/electricity/connections                    # Create connection
```

### Payment Service (3003)

```
POST   /api/v1/payments/initiate              # Initiate payment
GET    /api/v1/payments/verify/:txnId         # Verify payment
GET    /api/v1/payments                       # Get payment history
POST   /api/v1/payments/:paymentId/refund     # Initiate refund
```

---

## ðŸŽ¯ Technology Stack

### Backend Services

- **Runtime**: Node.js (v16+)
- **Framework**: Express.js
- **Auth DB**: PostgreSQL (OTP-based)
- **Other DBs**: MongoDB
- **Authentication**: JWT + OTP
- **Validation**: Joi
- **Security**: Helmet, CORS

### Key Features

- âœ… Microservices Architecture
- âœ… OTP-based Authentication
- âœ… JWT Token Management
- âœ… Multi-Gateway Payments
- âœ… Standardized API Responses
- âœ… Centralized Error Handling

---

**Status**: 3/8 Core Services Implemented
**PostgreSQL Password**: 1234567890
**OTP Expiry**: 10 minutes
**Max OTP Attempts**: 3
